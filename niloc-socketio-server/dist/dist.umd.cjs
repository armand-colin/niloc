(function(c,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(c=typeof globalThis<"u"?globalThis:c||self,n(c.dist={}))})(this,function(c){"use strict";var v=Object.defineProperty;var w=(c,n,_)=>n in c?v(c,n,{enumerable:!0,configurable:!0,writable:!0,value:_}):c[n]=_;var h=(c,n,_)=>(w(c,typeof n!="symbol"?n+"":n,_),_);var n=Object.defineProperty,_=(s,e,t)=>e in s?n(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,m=(s,e,t)=>(_(s,typeof e!="symbol"?e+"":e,t),t);class f{constructor(){m(this,"_listeners",{}),m(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const r of[...this._listeners[e]])r(t);if(this._onceListeners[e]){for(const r of[...this._onceListeners[e]])r(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}}var d;(s=>{const e={type:0},t={type:2};function r(){return e}s.broadcast=r;function i(){return t}s.host=i;function u(o){return{type:1,id:o}}s.to=u;function a(o,l){return o.type===0||l.address().type===0?!0:o.type===2?l.address().type===2:o.id===l.id()}s.match=a;function b(o){switch(o.type){case 0:return"*";case 1:return`:${o.id}`;case 2:return"host";default:return"?"}}s.toString=b;function L(o){return o==="*"?r():o==="host"?i():o.startsWith(":")?u(o.slice(1)):null}s.parse=L})(d||(d={}));var p;(s=>{function e(t){return{emitter(){return t.emitter},get:t.get,requestObject(r,i){return t.objectsEmitter.on(r,i),i(t.get(r)),{destroy(){t.objectsEmitter.off(r,i)}}}}}s.make=e})(p||(p={}));var y;(s=>{function e(t,r){return{type:t,create:i=>new r(i,t)}}s.create=e})(y||(y={}));var g;(s=>{function e(i,u,a){return{type:0,id:i,name:u,args:a}}s.request=e;function t(i,u){return{type:1,id:i,result:u}}s.response=t;function r(i,u){return{type:2,id:i,reason:u}}s.error=r})(g||(g={}));class k{constructor(e,t,r){h(this,"_id");h(this,"_address");h(this,"_emitter",new f);h(this,"_socketIOEmitter",new f);h(this,"_socket");h(this,"_onMessage",(e,t)=>{if(typeof e=="number"&&typeof t=="string")try{const r=JSON.parse(t);if(!r)return;this._emitter.emit("message",{channel:e,message:r})}catch(r){console.error(`Error receiving network message (${this._id})`,r)}});this._id=t,this._address=r?d.host():d.to(t),this._socket=e,e.on("message",this._onMessage),e.on("disconnect",()=>{this.destroy(),this._socketIOEmitter.emit("disconnect")})}id(){return this._id}address(){return this._address}emitter(){return this._emitter}socketIOEmitter(){return this._socketIOEmitter}send(e,t){this._socket.send(e,JSON.stringify(t))}destroy(){this._socket.removeAllListeners()}}class O{constructor(){h(this,"_peers",new Map);h(this,"_emitter",new f)}peers(){return this._peers.values()}emitter(){return this._emitter}addSocket(e,t,r){if(this._peers.has(t))return;const i=new k(e,t,r);i.socketIOEmitter().on("disconnect",()=>{this._peers.get(t)===i&&this._peers.delete(t)}),i.emitter().on("message",u=>{this._emitter.emit("message",{peerId:t,...u})}),this._peers.set(t,i)}}c.SocketIONetwork=O,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
