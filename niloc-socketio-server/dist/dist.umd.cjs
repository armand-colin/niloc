(function(c,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(c=typeof globalThis<"u"?globalThis:c||self,i(c.dist={}))})(this,function(c){"use strict";var w=Object.defineProperty;var S=(c,i,_)=>i in c?w(c,i,{enumerable:!0,configurable:!0,writable:!0,value:_}):c[i]=_;var u=(c,i,_)=>(S(c,typeof i!="symbol"?i+"":i,_),_);var i;(r=>{const e={type:0},t={type:2};function s(){return e}r.broadcast=s;function n(){return t}r.host=n;function d(o){return{type:1,id:o}}r.to=d;function k(o,b,l){return o.type===0||l.type===0?!0:o.type===2?l.type===2:o.id===b}r.match=k;function O(o){switch(o.type){case 0:return"*";case 1:return`:${o.id}`;case 2:return"host";default:return"?"}}r.toString=O;function L(o){return o==="*"?s():o==="host"?n():o.startsWith(":")?d(o.slice(1)):null}r.parse=L})(i||(i={}));var _;(r=>{function e(t){return{emitter(){return t.emitter},get:t.get,requestObject(s,n){return t.objectsEmitter.on(s,n),n(t.get(s)),{destroy(){t.objectsEmitter.off(s,n)}}}}}r.make=e})(_||(_={}));var a;(r=>{function e(t,s){return{type:t,create:n=>new s(n,t)}}r.create=e})(a||(a={}));var m=Object.defineProperty,p=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,f=(r,e,t)=>(p(r,typeof e!="symbol"?e+"":e,t),t);class h{constructor(){f(this,"_listeners",{}),f(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const s of[...this._listeners[e]])s(t);if(this._onceListeners[e]){for(const s of[...this._onceListeners[e]])s(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}}class y{constructor(e,t,s){u(this,"_id");u(this,"_address");u(this,"_emitter",new h);u(this,"_socketIOEmitter",new h);u(this,"_socket");u(this,"_onMessage",(e,t)=>{if(typeof e=="number"&&typeof t=="string")try{const s=JSON.parse(t);if(!s)return;this._emitter.emit("message",{channel:e,message:s})}catch(s){console.error(`Error receiving network message (${this._id})`,s)}});this._id=t,this._address=s?i.host():i.to(t),this._socket=e,e.on("message",this._onMessage),e.on("disconnect",()=>{this.destroy(),this._socketIOEmitter.emit("disconnect")})}id(){return this._id}address(){return this._address}emitter(){return this._emitter}socketIOEmitter(){return this._socketIOEmitter}send(e,t){this._socket.send(e,JSON.stringify(t))}destroy(){this._socket.removeAllListeners()}}class g{constructor(e){u(this,"_address");u(this,"_peers",new Map);u(this,"_emitter",new h);this._address=e?i.host():i.to("SERVER")}id(){return"SERVER"}address(){return this._address}peers(){return this._peers.values()}emitter(){return this._emitter}addSocket(e,t,s){if(this._peers.has(t))return;const n=new y(e,t,s);n.socketIOEmitter().on("disconnect",()=>{this._peers.get(t)===n&&this._peers.delete(t)}),n.emitter().on("message",d=>{this._emitter.emit("message",{peerId:t,...d})}),this._peers.set(t,n)}}c.SocketIONetwork=g,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
