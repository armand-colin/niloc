(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis<"u"?globalThis:o||self,n(o.dist={}))})(this,function(o){"use strict";var O=Object.defineProperty;var v=(o,n,u)=>n in o?O(o,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[n]=u;var d=(o,n,u)=>(v(o,typeof n!="symbol"?n+"":n,u),u);var n=Object.defineProperty,u=(s,e,t)=>e in s?n(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,f=(s,e,t)=>(u(s,typeof e!="symbol"?e+"":e,t),t);class l{constructor(){f(this,"_listeners",{}),f(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const r of[...this._listeners[e]])r(t);if(this._onceListeners[e]){for(const r of[...this._onceListeners[e]])r(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}}var h;(s=>{const e={type:0};function t(){return e}s.broadcast=t;function r(c){return{type:1,id:c}}s.to=r;function i(c,g){return c.type===0||g.type===0?!0:c.id===g.id}s.match=i;function _(c){switch(c.type){case 0:return"*";case 1:return`:${c.id}`;default:return"?"}}s.toString=_;function a(c){return c==="*"?t():c.startsWith(":")?r(c.slice(1)):null}s.parse=a})(h||(h={}));var p;(s=>{function e(i,_,a){return{type:0,id:i,name:_,data:a}}s.request=e;function t(i,_){return{type:1,id:i,data:_}}s.response=t;function r(i,_){return{type:2,id:i,reason:_}}s.error=r})(p||(p={}));var m;(s=>{function e(t){return{emitter(){return t.emitter},get:t.get,requestObject(r,i){return t.objectsEmitter.on(r,i),i(t.get(r)),{destroy(){t.objectsEmitter.off(r,i)}}}}}s.make=e})(m||(m={}));var y;(s=>{function e(t,r){return{type:t,create:i=>new r(i,t)}}s.create=e})(y||(y={}));class b{constructor(e,t){d(this,"_id");d(this,"_address");d(this,"_emitter",new l);d(this,"_socket");d(this,"_onMessage",(e,t)=>{if(console.log("recv",e,t),typeof e=="number"&&typeof t=="string")try{const r=JSON.parse(t);if(typeof r!="object")return;this._emitter.emit("message",{channel:e,message:r})}catch(r){console.error("Error while parsing message",r)}});this._id=e,this._socket=t,this._address=h.broadcast(),this._socket.on("message",this._onMessage)}id(){return this._id}address(){return this._address}emitter(){return this._emitter}send(e,t){this._socket.send(e,JSON.stringify(t))}}class L{constructor(e,t){d(this,"_id");d(this,"_emitter",new l);d(this,"_peer");this._id=e,this._peer=new b("HOST",t),this._peer.emitter().on("message",({channel:r,message:i})=>{console.log("NETWORK:message",r,i),this._emitter.emit("message",{peerId:this._peer.id(),channel:r,message:i})})}id(){return this._id}emitter(){return this._emitter}*peers(){yield this._peer}}o.SocketIONetwork=L,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
