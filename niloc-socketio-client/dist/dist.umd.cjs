(function(n,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n.dist={}))})(this,function(n){"use strict";var b=Object.defineProperty;var L=(n,r,_)=>r in n?b(n,r,{enumerable:!0,configurable:!0,writable:!0,value:_}):n[r]=_;var d=(n,r,_)=>(L(n,typeof r!="symbol"?r+"":r,_),_);var r=Object.defineProperty,_=(s,e,t)=>e in s?r(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,f=(s,e,t)=>(_(s,typeof e!="symbol"?e+"":e,t),t);let l=class{constructor(){f(this,"_listeners",{}),f(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const i of[...this._listeners[e]])i(t);if(this._onceListeners[e]){for(const i of[...this._onceListeners[e]])i(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}};var u;(s=>{const e={type:0};function t(){return e}s.broadcast=t;function i(o){return{type:1,id:o}}s.to=i;function c(o,m){return o.type===0||m.type===0?!0:o.id===m.id}s.match=c;function h(o){switch(o.type){case 0:return"*";case 1:return`:${o.id}`;default:return"?"}}s.toString=h;function a(o){return o==="*"?t():o.startsWith(":")?i(o.slice(1)):null}s.parse=a})(u||(u={}));var p;(s=>{function e(c,h,a){return{type:0,id:c,name:h,data:a}}s.request=e;function t(c,h){return{type:1,id:c,data:h}}s.response=t;function i(c,h){return{type:2,id:c,reason:h}}s.error=i})(p||(p={}));class y{constructor(e,t){d(this,"_id");d(this,"_address");d(this,"_emitter",new l);d(this,"_socket");d(this,"_onMessage",(e,t)=>{if(typeof e=="number"&&typeof t=="string")try{const i=JSON.parse(t);if(typeof i!="object")return;this._emitter.emit("message",{channel:e,message:i})}catch(i){console.error("Error while parsing message",i)}});this._id=e,this._socket=t,this._address=u.broadcast(),this._socket.on("message",this._onMessage)}id(){return this._id}address(){return this._address}emitter(){return this._emitter}send(e,t){this._socket.send(e,JSON.stringify(t))}}class g{constructor(e,t){d(this,"_id");d(this,"_emitter",new l);d(this,"_peer");this._id=e,this._peer=new y("HOST",t),this._peer.emitter().on("message",({channel:i,message:c})=>{this._emitter.emit("message",{peerId:this._peer.id(),channel:i,message:c})})}id(){return this._id}emitter(){return this._emitter}*peers(){yield this._peer}}n.SocketIONetwork=g,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
