(function(o,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(o=typeof globalThis<"u"?globalThis:o||self,i(o.dist={}))})(this,function(o){"use strict";var S=Object.defineProperty;var k=(o,i,_)=>i in o?S(o,i,{enumerable:!0,configurable:!0,writable:!0,value:_}):o[i]=_;var d=(o,i,_)=>(k(o,typeof i!="symbol"?i+"":i,_),_);var i;(s=>{const e={type:0},t={type:2};function r(){return e}s.broadcast=r;function c(){return t}s.host=c;function u(n){return{type:1,id:n}}s.to=u;function b(n,w,l){return n.type===0||l.type===0?!0:n.type===2?l.type===2:n.id===w}s.match=b;function v(n){switch(n.type){case 0:return"*";case 1:return`:${n.id}`;case 2:return"host";default:return"?"}}s.toString=v;function L(n){return n==="*"?r():n==="host"?c():n.startsWith(":")?u(n.slice(1)):null}s.parse=L})(i||(i={}));var _;(s=>{function e(t){return{emitter(){return t.emitter},get:t.get,requestObject(r,c){return t.objectsEmitter.on(r,c),c(t.get(r)),{destroy(){t.objectsEmitter.off(r,c)}}}}}s.make=e})(_||(_={}));var a;(s=>{function e(t,r){return{type:t,create:c=>new r(c,t)}}s.create=e})(a||(a={}));var m=Object.defineProperty,p=(s,e,t)=>e in s?m(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,h=(s,e,t)=>(p(s,typeof e!="symbol"?e+"":e,t),t);class f{constructor(){h(this,"_listeners",{}),h(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const r of[...this._listeners[e]])r(t);if(this._onceListeners[e]){for(const r of[...this._onceListeners[e]])r(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}}class y{constructor(e,t){d(this,"_id");d(this,"_address");d(this,"_emitter",new f);d(this,"_socket");d(this,"_onMessage",(e,t)=>{if(typeof e=="number"&&typeof t=="string")try{const r=JSON.parse(t);if(typeof r!="object")return;this._emitter.emit("message",{channel:e,message:r})}catch(r){console.error("Error while parsing message",r)}});this._id=e,this._socket=t,this._address=i.broadcast(),this._socket.on("message",this._onMessage)}id(){return this._id}address(){return this._address}emitter(){return this._emitter}send(e,t){this._socket.send(e,JSON.stringify(t))}}class g{constructor(e,t,r=!1){d(this,"_id");d(this,"_address");d(this,"_emitter",new f);d(this,"_serverPeer");this._id=e,this._address=r?i.host():i.to(e),this._serverPeer=new y("SERVER",t),this._serverPeer.emitter().on("message",({channel:c,message:u})=>{this._emitter.emit("message",{peerId:this._serverPeer.id(),channel:c,message:u})})}id(){return this._id}address(){return this._address}emitter(){return this._emitter}*peers(){yield this._serverPeer}}o.SocketIONetwork=g,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
