(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.dist={}))})(this,function(n){"use strict";var O=Object.defineProperty;var k=(n,i,h)=>i in n?O(n,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[i]=h;var d=(n,i,h)=>(k(n,typeof i!="symbol"?i+"":i,h),h);var i=Object.defineProperty,h=(s,e,t)=>e in s?i(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,l=(s,e,t)=>(h(s,typeof e!="symbol"?e+"":e,t),t);let u=class{constructor(){l(this,"_listeners",{}),l(this,"_onceListeners",{})}on(e,t){this._listeners[e]||(this._listeners[e]=new Set),this._listeners[e].add(t)}off(e,t){this._listeners[e]&&(this._listeners[e].delete(t),this._listeners[e].size===0&&delete this._listeners[e])}once(e,t){this._onceListeners[e]||(this._onceListeners[e]=new Set),this._onceListeners[e].add(t)}offOnce(e,t){this._onceListeners[e]&&(this._onceListeners[e].delete(t),this._onceListeners[e].size===0&&delete this._onceListeners[e])}emit(e,t){if(this._listeners[e])for(const r of[...this._listeners[e]])r(t);if(this._onceListeners[e]){for(const r of[...this._onceListeners[e]])r(t);delete this._onceListeners[e]}}removeAllListeners(){this._listeners={},this._onceListeners={}}};var a;(s=>{const e={type:0};function t(){return e}s.broadcast=t;function r(o){return{type:1,id:o}}s.to=r;function c(o,p){return o.type===0||p.type===0?!0:o.id===p.id}s.match=c;function _(o){switch(o.type){case 0:return"*";case 1:return`:${o.id}`;default:return"?"}}s.toString=_;function f(o){return o==="*"?t():o.startsWith(":")?r(o.slice(1)):null}s.parse=f})(a||(a={}));var m;(s=>{function e(c,_,f){return{type:0,id:c,name:_,data:f}}s.request=e;function t(c,_){return{type:1,id:c,data:_}}s.response=t;function r(c,_){return{type:2,id:c,reason:_}}s.error=r})(m||(m={}));class y{constructor(e,t){d(this,"_id");d(this,"_address");d(this,"_emitter",new u);d(this,"_socketIOEmitter",new u);d(this,"_socket");d(this,"_onMessage",(e,t)=>{if(typeof e=="number"&&typeof t=="string")try{const r=JSON.parse(t);if(!r)return;this._emitter.emit("message",{channel:e,message:r})}catch(r){console.error(`Error receiving network message (${this._id})`,r)}});this._id=e,this._address=a.to(e),this._socket=t,t.on("message",this._onMessage),t.on("disconnect",()=>{this.destroy(),this._socketIOEmitter.emit("disconnect")})}id(){return this._id}address(){return this._address}emitter(){return this._emitter}socketIOEmitter(){return this._socketIOEmitter}send(e,t){this._socket.send(e,JSON.stringify(t))}destroy(){this._socket.removeAllListeners()}}class g{constructor(){d(this,"_peers",new Map);d(this,"_emitter",new u)}addSocket(e){const t=e.handshake.query.id;if(this._peers.has(t))return;const r=new y(t,e);r.socketIOEmitter().on("disconnect",()=>{this._peers.get(t)===r&&this._peers.delete(t)}),r.emitter().on("message",c=>{this._emitter.emit("message",{peerId:t,...c})}),this._peers.set(t,r)}id(){return"HOST"}peers(){return this._peers.values()}emitter(){return this._emitter}}n.SocketIONetwork=g,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
