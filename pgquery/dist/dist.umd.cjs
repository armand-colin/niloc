(function(o,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(o=typeof globalThis<"u"?globalThis:o||self,u(o.dist={}))})(this,function(o){"use strict";class u{constructor(t){this._mark=t}}(i=>{i.Number=new i(0),i.String=new i(""),i.Date=new i(new globalThis.Date)})(u||(u={}));class g extends _{constructor(t,s){super(t,s,"AND")}}class v extends _{constructor(t,s){super(t,s,"OR")}}var w;w=Symbol("Statement.symbol");class d{constructor(){this[w]=!0}or(t){return new v(this,t)}and(t){return new g(this,t)}}class _ extends d{constructor(t,s,n){super(),this.a=t,this.b=s,this.op=n}string(){return`${this.a.string()} ${this.op} ${this.b.string()}`}visit(t){this.a.visit(t),this.b.visit(t)}}class y extends _{constructor(t,s){super(t,s,"=")}}class p{constructor(t,s){this.column=t,this.value=s}visit(t){this.column.visit(t),this.value.visit(t)}string(){return`${this.column.string()} LIKE % | ${this.value.string()} | %`}}class r{constructor(t){this.value=t,this.index=0}string(){return"$"+this.index}visit(t){this.index>0||(this.index=t.index,t.index++,t.params.push(this.value))}}(i=>{function t(s){return s instanceof i?s:new i(s)}i.from=t})(r||(r={}));var a;(i=>{i.__name=Symbol("Table.name");function t(n){return n[i.__name]}i.name=t;function s(n,m){const e={[i.__name]:n};for(const h in m){const E=m[h],A=new c(e,h,E);e[h]=A}return e}i.create=s})(a||(a={}));class b extends d{constructor(t,s){super(),this.column=t,this.set=s}visit(t){this.column.visit(t),this.set.visit(t)}string(){return`${this.column.string()} IN (${this.set.string()})`}}class x{constructor(t){this._values=t.map(s=>r.from(s))}visit(t){for(const s of this._values)s.visit(t)}string(){return this._values.map(t=>t.string()).join(", ")}}class c{constructor(t,s,n){this.table=t,this.name=s,this.type=n}definition(){return this.string()}equals(t){const s=t instanceof c?t:new r(t);return new y(this,s)}string(){return`${a.name(this.table)}.${this.name}`}visit(t){}like(t){return t instanceof r||(t=new r(t)),new p(this,t)}as(t){return new S(t,this)}in(t){return Array.isArray(t)?new b(this,new x(t)):new b(this,t)}}class S extends c{constructor(t,s){super(s.table,t,s.type),this._column=s}definition(){return`${this._column.definition()} AS ${this.name}`}string(){return this.name}visit(t){this._column.visit(t)}}class j extends c{constructor(t){super(t.table,"count",o.query.number),this._column=t}definition(){return`COUNT(${this._column.string()})`}string(){return this.name}visit(t){this._column.visit(t)}}class B{constructor(t,s,n){this.table=t,this.a=s,this.b=n}visit(t){this.a.visit(t),this.b.visit(t)}string(){return`JOIN ${a.name(this.table)} ON ${this.a.string()} = ${this.b.string()}`}}var l;(i=>{i.__columns=Symbol("Query.columns")})(l||(l={}));class O{constructor(t){this.statement=t}string(){return`WHERE ${this.statement.string()}`}visit(t){this.statement.visit(t)}}var $;class f extends($=d,l.__columns,$){constructor(t){super(),this.data=t,this._orderBy=null,this._offset=null,this._limit=null,this[l.__columns]=t.columns}string(){let s=`SELECT ${this[l.__columns].map(n=>n.definition()).join(", ")} FROM ${a.name(this.data.table)}`;for(const n of this.data.joins)s+=`
`+n.string();return this.data.where&&(s+=`
`+this.data.where.string()),this._orderBy&&(s+=`
ORDER BY ${this._orderBy.column.string()} ${this._orderBy.order}`),this._limit&&(s+=`
LIMIT ${this._limit.string()}`),this._offset&&(s+=`
OFFSET ${this._offset.string()}`),s}visit(t){for(const s of this.data.joins)s.visit(t);this.data.where&&this.data.where.visit(t),this._orderBy&&this._orderBy.column.visit(t),this._offset instanceof r&&this._offset.visit(t),this._limit instanceof r&&this._limit.visit(t)}join(t){return{on:(s,n)=>new f({...this.data,joins:[...this.data.joins,new B(t,s,n)]})}}where(t){return new f({...this.data,where:new O(t)})}orderBy(t){return this._orderBy={column:t,order:"ASC"},this}orderByDesc(t){return this._orderBy={column:t,order:"DESC"},this}limit(t){return this._limit=r.from(t),this}offset(t){return this._offset=r.from(t),this}}o.query=void 0,(i=>{function t(...e){return{from(h){return new f({table:h,columns:e,joins:[],where:null})}}}i.select=t;function s(e,h){return new v(e,h)}i.or=s;function n(e,h){return new g(e,h)}i.and=n;function m(e){return new j(e)}i.count=m,i.string=u.String,i.date=u.Date,i.number=u.Number})(o.query||(o.query={})),Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
